(function(A){A.Jcrop=function(k,Ai){var Aj=A.extend({},A.Jcrop.defaults),Ao,o,F=false;function L(Au){return parseInt(Au,10)+"px"}function Ap(Au){return parseInt(Au,10)+"%"}function R(Au){return Aj.baseClass+"-"+Au}function d(){return A.fx.step.hasOwnProperty("backgroundColor")}function X(Av){var Au=A(Av).offset();return[Au.left,Au.top]}function K(Au){return[(Au.pageX-Ao[0]),(Au.pageY-Ao[1])]}function I(Au){if(typeof(Au)!=="object"){Au={}}Aj=A.extend(Aj,Au);if(typeof(Aj.onChange)!=="function"){Aj.onChange=function(){}}if(typeof(Aj.onSelect)!=="function"){Aj.onSelect=function(){}}if(typeof(Aj.onRelease)!=="function"){Aj.onRelease=function(){}}}function Ag(Au){if(Au!==o){Ac.setCursor(Au);o=Au}}function J(Ay,Ax){Ao=X(H);Ac.setCursor(Ay==="move"?Ay:Ay+"-resize");if(Ay==="move"){return Ac.activateHandlers(c(Ax),Ah)}var Av=T.getFixed();var Au=U(Ay);var Aw=T.getCorner(U(Au));T.setPressed(T.getCorner(Au));T.setCurrent(Aw);Ac.activateHandlers(G(Ay,Av),Ah)}function G(Av,Au){return function(Aw){if(!Aj.aspectRatio){switch(Av){case"e":Aw[1]=Au.y2;break;case"w":Aw[1]=Au.y2;break;case"n":Aw[0]=Au.x2;break;case"s":Aw[0]=Au.x2;break}}else{switch(Av){case"e":Aw[1]=Au.y+1;break;case"w":Aw[1]=Au.y+1;break;case"n":Aw[0]=Au.x+1;break;case"s":Aw[0]=Au.x+1;break}}T.setCurrent(Aw);u.update()}}function c(Au){var Av=Au;N.watchKeys();return function(Aw){T.moveOffset([Aw[0]-Av[0],Aw[1]-Av[1]]);Av=Aw;u.update()}}function U(Au){switch(Au){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function S(Au){return function(Av){if(Aj.disabled){return false}if((Au==="move")&&!Aj.allowMove){return false}D=true;J(Au,K(Av));Av.stopPropagation();Av.preventDefault();return false}}function Ab(Av,Ax,Ay){var Aw=Av.width(),Au=Av.height();if((Aw>Ax)&&Ax>0){Aw=Ax;Au=(Ax/Av.width())*Av.height()}if((Au>Ay)&&Ay>0){Au=Ay;Aw=(Ay/Av.height())*Av.width()}q=Av.width()/Aw;V=Av.height()/Au;Av.width(Aw).height(Au)}function m(Au){return{x:parseInt(Au.x*q,10),y:parseInt(Au.y*V,10),x2:parseInt(Au.x2*q,10),y2:parseInt(Au.y2*V,10),w:parseInt(Au.w*q,10),h:parseInt(Au.h*V,10)}}function Ah(Au){var Av=T.getFixed();if((Av.w>Aj.minSelect[0])&&(Av.h>Aj.minSelect[1])){u.enableHandles();u.done()}else{u.release()}Ac.setCursor(Aj.allowSelect?"crosshair":"default")}function b(Av){if(Aj.disabled){return false}if(!Aj.allowSelect){return false}D=true;Ao=X(H);u.disableHandles();Ag("crosshair");var Au=K(Av);T.setPressed(Au);u.update();Ac.activateHandlers(n,Ah);N.watchKeys();Av.stopPropagation();Av.preventDefault();return false}function n(Au){T.setCurrent(Au);u.update()}function At(){var Au=A("<div></div>").addClass(R("tracker"));if(A.browser.msie){Au.css({opacity:0,backgroundColor:"white"})}return Au}if(A.browser.msie&&(A.browser.version.split(".")[0]==="6")){F=true}if(typeof(k)!=="object"){k=A(k)[0]}if(typeof(Ai)!=="object"){Ai={}}I(Ai);var P={border:"none",margin:0,padding:0,position:"absolute"};var Ad=A(k);var H=Ad.clone().removeAttr("id").css(P);H.width(Ad.width());H.height(Ad.height());Ad.after(H).hide();Ab(H,Aj.boxWidth,Aj.boxHeight);var B=H.width(),M=H.height(),Y=A("<div />").width(B).height(M).addClass(R("holder")).css({position:"relative",backgroundColor:Aj.bgColor}).insertAfter(Ad).append(H);delete (Aj.bgColor);if(Aj.addClass){Y.addClass(Aj.addClass)}var j=A("<img />").attr("src",H.attr("src")).css(P).width(B).height(M),As=A("<div />").width(Ap(100)).height(Ap(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(j),Aa=A("<div />").width(Ap(100)).height(Ap(100)).css("zIndex",320),g=A("<div />").css({position:"absolute",zIndex:300}).insertBefore(H).append(As,Aa);if(F){g.css({overflowY:"hidden"})}var Af=Aj.boundary;var i=At().width(B+(Af*2)).height(M+(Af*2)).css({position:"absolute",top:L(-Af),left:L(-Af),zIndex:290}).mousedown(b);var e=Aj.bgOpacity,C,Ae,z,Q,q,V,Ak=true,D,v,An;Ao=X(H);var p=(function(){function Av(){var AA={},Ay=["touchstart","touchmove","touchend"],Ax=document.createElement("div"),AC;try{for(AC=0;AC<Ay.length;AC++){var AB=Ay[AC];AB="on"+AB;var Aw=(AB in Ax);if(!Aw){Ax.setAttribute(AB,"return;");Aw=typeof Ax[AB]=="function"}AA[Ay[AC]]=Aw}return AA.touchstart&&AA.touchend&&AA.touchmove}catch(Az){return false}}function Au(){if((Aj.touchSupport===true)||(Aj.touchSupport===false)){return Aj.touchSupport}else{return Av()}}return{createDragger:function(Aw){return function(Ax){Ax.pageX=Ax.originalEvent.changedTouches[0].pageX;Ax.pageY=Ax.originalEvent.changedTouches[0].pageY;if(Aj.disabled){return false}if((Aw==="move")&&!Aj.allowMove){return false}D=true;J(Aw,K(Ax));Ax.stopPropagation();Ax.preventDefault();return false}},newSelection:function(Aw){Aw.pageX=Aw.originalEvent.changedTouches[0].pageX;Aw.pageY=Aw.originalEvent.changedTouches[0].pageY;return b(Aw)},isSupported:Av,support:Au()}}());var T=(function(){var AI=0,AJ=0,AA=0,AB=0,Au,AF;function Ay(AK){AK=AC(AK);AA=AI=AK[0];AB=AJ=AK[1]}function Aw(AK){AK=AC(AK);Au=AK[0]-AA;AF=AK[1]-AB;AA=AK[0];AB=AK[1]}function AE(){return[Au,AF]}function AH(AM){var AL=AM[0],AK=AM[1];if(0>AI+AL){AL-=AL+AI}if(0>AJ+AK){AK-=AK+AJ}if(M<AB+AK){AK+=M-(AB+AK)}if(B<AA+AL){AL+=B-(AA+AL)}AI+=AL;AA+=AL;AJ+=AK;AB+=AK}function Ax(AK){var AL=AG();switch(AK){case"ne":return[AL.x2,AL.y];case"nw":return[AL.x,AL.y];case"se":return[AL.x2,AL.y2];case"sw":return[AL.x,AL.y2]}}function AG(){if(!Aj.aspectRatio){return AD()}var AU=Aj.aspectRatio,AQ=Aj.minSize[0]/q,AN=Aj.maxSize[0]/q,AM=Aj.maxSize[1]/V,AR=AA-AI,AK=AB-AJ,AS=Math.abs(AR),AL=Math.abs(AK),AT=AS/AL,AO,AP;if(AN===0){AN=B*10}if(AM===0){AM=M*10}if(AT<AU){AP=AB;w=AL*AU;AO=AR<0?AI-w:w+AI;if(AO<0){AO=0;h=Math.abs((AO-AI)/AU);AP=AK<0?AJ-h:h+AJ}else{if(AO>B){AO=B;h=Math.abs((AO-AI)/AU);AP=AK<0?AJ-h:h+AJ}}}else{AO=AA;h=AS/AU;AP=AK<0?AJ-h:AJ+h;if(AP<0){AP=0;w=Math.abs((AP-AJ)*AU);AO=AR<0?AI-w:w+AI}else{if(AP>M){AP=M;w=Math.abs(AP-AJ)*AU;AO=AR<0?AI-w:w+AI}}}if(AO>AI){if(AO-AI<AQ){AO=AI+AQ}else{if(AO-AI>AN){AO=AI+AN}}if(AP>AJ){AP=AJ+(AO-AI)/AU}else{AP=AJ-(AO-AI)/AU}}else{if(AO<AI){if(AI-AO<AQ){AO=AI-AQ}else{if(AI-AO>AN){AO=AI-AN}}if(AP>AJ){AP=AJ+(AI-AO)/AU}else{AP=AJ-(AI-AO)/AU}}}if(AO<0){AI-=AO;AO=0}else{if(AO>B){AI-=AO-B;AO=B}}if(AP<0){AJ-=AP;AP=0}else{if(AP>M){AJ-=AP-M;AP=M}}return Av(Az(AI,AJ,AO,AP))}function AC(AK){if(AK[0]<0){AK[0]=0}if(AK[1]<0){AK[1]=0}if(AK[0]>B){AK[0]=B}if(AK[1]>M){AK[1]=M}return[AK[0],AK[1]]}function Az(AQ,AR,AM,AN){var AK=AQ,AO=AM,AL=AR,AP=AN;if(AM<AQ){AK=AM;AO=AQ}if(AN<AR){AL=AN;AP=AR}return[Math.round(AK),Math.round(AL),Math.round(AO),Math.round(AP)]}function AD(){var AM=AA-AI,AL=AB-AJ,AK;if(C&&(Math.abs(AM)>C)){AA=(AM>0)?(AI+C):(AI-C)}if(Ae&&(Math.abs(AL)>Ae)){AB=(AL>0)?(AJ+Ae):(AJ-Ae)}if(Q/V&&(Math.abs(AL)<Q/V)){AB=(AL>0)?(AJ+Q/V):(AJ-Q/V)}if(z/q&&(Math.abs(AM)<z/q)){AA=(AM>0)?(AI+z/q):(AI-z/q)}if(AI<0){AA-=AI;AI-=AI}if(AJ<0){AB-=AJ;AJ-=AJ}if(AA<0){AI-=AA;AA-=AA}if(AB<0){AJ-=AB;AB-=AB}if(AA>B){AK=AA-B;AI-=AK;AA-=AK}if(AB>M){AK=AB-M;AJ-=AK;AB-=AK}if(AI>B){AK=AI-M;AB-=AK;AJ-=AK}if(AJ>M){AK=AJ-M;AB-=AK;AJ-=AK}return Av(Az(AI,AJ,AA,AB))}function Av(AK){return{x:AK[0],y:AK[1],x2:AK[2],y2:AK[3],w:AK[2]-AK[0],h:AK[3]-AK[1]}}return{flipCoords:Az,setPressed:Ay,setCurrent:Aw,getOffset:AE,moveOffset:AH,getCorner:Ax,getFixed:AG}}());var u=(function(){var AS,AN=370;var AO={};var AE={};var Aw=false;var Ax=Aj.handleOffset;function AH(AU){var AT=A("<div />").css({position:"absolute",opacity:Aj.borderOpacity}).addClass(R(AU));As.append(AT);return AT}function AI(AT,AV){var AU=A("<div />").mousedown(S(AT)).css({cursor:AT+"-resize",position:"absolute",zIndex:AV});if(p.support){AU.bind("touchstart",p.createDragger(AT))}Aa.append(AU);return AU}function Av(AT){return AI(AT,AN++).css({top:L(-Ax+1),left:L(-Ax+1),opacity:Aj.handleOpacity}).addClass(R("handle"))}function AF(AU){var AT=Aj.handleSize,AW=AT,AV=AT,AX=Ax,AY=Ax;switch(AU){case"n":case"s":AV=Ap(100);break;case"e":case"w":AW=Ap(100);break}return AI(AU,AN++).width(AV).height(AW).css({top:L(-AX+1),left:L(-AY+1)})}function AC(AT){var AU;for(AU=0;AU<AT.length;AU++){AE[AT[AU]]=Av(AT[AU])}}function AJ(AY){var A1=Math.round((AY.h/2)-Ax),A0=Math.round((AY.w/2)-Ax),AZ=-Ax+1,AT=-Ax+1,AU=AY.w-Ax,AX=AY.h-Ax,AV,AW;if(AE.e){AE.e.css({top:L(A1),left:L(AU)});AE.w.css({top:L(A1)});AE.s.css({top:L(AX),left:L(A0)});AE.n.css({left:L(A0)})}if(AE.ne){AE.ne.css({left:L(AU)});AE.se.css({top:L(AX),left:L(AU)});AE.sw.css({top:L(AX)})}if(AE.b){AE.b.css({top:L(AX)});AE.r.css({left:L(AU)})}}function AB(AT,AU){j.css({top:L(-AU),left:L(-AT)});g.css({top:L(AU),left:L(AT)})}function AL(AT,AU){g.width(AT).height(AU)}function Au(){var AT=T.getFixed();T.setPressed([AT.x,AT.y]);T.setCurrent([AT.x2,AT.y2]);AK()}function AK(){if(AS){return AA()}}function AA(){var AT=T.getFixed();AL(AT.w,AT.h);AB(AT.x,AT.y);if(Aw){AJ(AT)}if(!AS){AR()}Aj.onChange.call(Am,m(AT))}function AR(){g.show();if(Aj.bgFade){H.fadeTo(Aj.fadeTime,e)}else{H.css("opacity",e)}AS=true}function AG(){AM();g.hide();if(Aj.bgFade){H.fadeTo(Aj.fadeTime,1)}else{H.css("opacity",1)}AS=false;Aj.onRelease.call(Am)}function AQ(){if(Aw){AJ(T.getFixed());Aa.show()}}function AP(){Aw=true;if(Aj.allowResize){AJ(T.getFixed());Aa.show();return true}}function AM(){Aw=false;Aa.hide()}function AD(AT){if(v===AT){AM()}else{AP()}}function Az(){AD(false);Au()}if(Aj.drawBorders){AO={top:AH("hline"),bottom:AH("hline bottom"),left:AH("vline"),right:AH("vline right")}}if(Aj.dragEdges){AE.t=AF("n");AE.b=AF("s");AE.r=AF("e");AE.l=AF("w")}if(Aj.sideHandles){AC(["n","s","e","w"])}if(Aj.cornerHandles){AC(["sw","nw","ne","se"])}var Ay=At().mousedown(S("move")).css({cursor:"move",position:"absolute",zIndex:360});if(p.support){Ay.bind("touchstart.jcrop",p.createDragger("move"))}As.append(Ay);AM();return{updateVisible:AK,update:AA,release:AG,refresh:Au,isAwake:function(){return AS},setCursor:function(AT){Ay.css("cursor",AT)},enableHandles:AP,enableOnly:function(){Aw=true},showHandles:AQ,disableHandles:AM,animMode:AD,done:Az}}());var Ac=(function(){var AC=function(){},Ay=function(){},AB=Aj.trackDocument;function Aw(){i.css({zIndex:450});if(AB){A(document).bind("mousemove",AE).bind("mouseup",Az)}}function Av(){i.css({zIndex:290});if(AB){A(document).unbind("mousemove",AE).unbind("mouseup",Az)}}function AE(AF){AC(K(AF));return false}function Az(AF){AF.preventDefault();AF.stopPropagation();if(D){D=false;Ay(K(AF));if(u.isAwake()){Aj.onSelect.call(Am,m(T.getFixed()))}Av();AC=function(){};Ay=function(){}}return false}function AA(AG,AF){D=true;AC=AG;Ay=AF;Aw();return false}function Au(AF){AF.pageX=AF.originalEvent.changedTouches[0].pageX;AF.pageY=AF.originalEvent.changedTouches[0].pageY;return AE(AF)}function Ax(AF){AF.pageX=AF.originalEvent.changedTouches[0].pageX;AF.pageY=AF.originalEvent.changedTouches[0].pageY;return Az(AF)}function AD(AF){i.css("cursor",AF)}if(p.support){A(document).bind("touchmove",Au).bind("touchend",Ax)}if(!AB){i.mousemove(AE).mouseup(Az).mouseout(Az)}H.before(i);return{activateHandlers:AA,setCursor:AD}}());var N=(function(){var Ay=A('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),Av=A("<div />").css({position:"absolute",overflow:"hidden"}).append(Ay);function Au(){if(Aj.keySupport){Ay.show();Ay.focus()}}function Az(AA){Ay.hide()}function Ax(AC,AA,AB){if(Aj.allowMove){T.moveOffset([AA,AB]);u.updateVisible()}AC.preventDefault();AC.stopPropagation()}function Aw(AB){if(AB.ctrlKey){return true}An=AB.shiftKey?true:false;var AA=An?10:1;switch(AB.keyCode){case 37:Ax(AB,-AA,0);break;case 39:Ax(AB,AA,0);break;case 38:Ax(AB,0,-AA);break;case 40:Ax(AB,0,AA);break;case 27:u.release();break;case 9:return true}return false}if(Aj.keySupport){Ay.keydown(Aw).blur(Az);if(F||!Aj.fixedSupport){Ay.css({position:"absolute",left:"-20px"});Av.append(Ay).insertBefore(H)}else{Ay.insertBefore(H)}}return{watchKeys:Au}}());function E(Au){Y.removeClass().addClass(R("holder")).addClass(Au)}function t(AD,Ax){var AC=parseInt(AD[0],10)/q,AB=parseInt(AD[1],10)/V,AK=parseInt(AD[2],10)/q,AL=parseInt(AD[3],10)/V;if(v){return}var AN=T.flipCoords(AC,AB,AK,AL),AF=T.getFixed(),Av=[AF.x,AF.y,AF.x2,AF.y2],AG=Av,AI=Aj.animationDelay,AM=AN[0]-Av[0],Aw=AN[1]-Av[1],Az=AN[2]-Av[2],AJ=AN[3]-Av[3],AA=0,AH=Aj.swingSpeed;x=AG[0];y=AG[1];AK=AG[2];AL=AG[3];u.animMode(true);var Au;function Ay(){window.setTimeout(AE,AI)}var AE=(function(){return function(){AA+=(100-AA)/AH;AG[0]=x+((AA/100)*AM);AG[1]=y+((AA/100)*Aw);AG[2]=AK+((AA/100)*Az);AG[3]=AL+((AA/100)*AJ);if(AA>=99.8){AA=100}if(AA<100){l(AG);Ay()}else{u.done();if(typeof(Ax)==="function"){Ax.call(Am)}}}}());Ay()}function r(Au){l([parseInt(Au[0],10)/q,parseInt(Au[1],10)/V,parseInt(Au[2],10)/q,parseInt(Au[3],10)/V])}function l(Au){T.setPressed([Au[0],Au[1]]);T.setCurrent([Au[2],Au[3]]);u.update()}function W(){return m(T.getFixed())}function Aq(){return T.getFixed()}function s(Au){I(Au);a()}function Al(){Aj.disabled=true;u.disableHandles();u.setCursor("default");Ac.setCursor("default")}function Ar(){Aj.disabled=false;a()}function f(){u.done();Ac.activateHandlers(null,null)}function O(){Y.remove();Ad.show();A(k).removeData("Jcrop")}function Z(Aw,Au){u.release();Al();var Av=new Image();Av.onload=function(){var Ax=Av.width;var AA=Av.height;var Az=Aj.boxWidth;var Ay=Aj.boxHeight;H.width(Ax).height(AA);H.attr("src",Aw);j.attr("src",Aw);Ab(H,Az,Ay);B=H.width();M=H.height();j.width(B).height(M);i.width(B+(Af*2)).height(M+(Af*2));Y.width(B).height(M);Ar();if(typeof(Au)==="function"){Au.call(Am)}};Av.src=Aw}function a(Au){if(Aj.allowResize){if(Au){u.enableOnly()}else{u.enableHandles()}}else{u.disableHandles()}Ac.setCursor(Aj.allowSelect?"crosshair":"default");u.setCursor(Aj.allowMove?"move":"default");if(Aj.hasOwnProperty("setSelect")){r(Aj.setSelect);u.done();delete (Aj.setSelect)}if(Aj.hasOwnProperty("trueSize")){q=Aj.trueSize[0]/B;V=Aj.trueSize[1]/M}if(Aj.hasOwnProperty("bgColor")){if(d()&&Aj.fadeTime){Y.animate({backgroundColor:Aj.bgColor},{queue:false,duration:Aj.fadeTime})}else{Y.css("backgroundColor",Aj.bgColor)}delete (Aj.bgColor)}if(Aj.hasOwnProperty("bgOpacity")){e=Aj.bgOpacity;if(u.isAwake()){if(Aj.fadeTime){H.fadeTo(Aj.fadeTime,e)}else{Y.css("opacity",Aj.opacity)}}delete (Aj.bgOpacity)}C=Aj.maxSize[0]||0;Ae=Aj.maxSize[1]||0;z=Aj.minSize[0]||0;Q=Aj.minSize[1]||0;if(Aj.hasOwnProperty("outerImage")){H.attr("src",Aj.outerImage);delete (Aj.outerImage)}u.refresh()}if(p.support){i.bind("touchstart",p.newSelection)}Aa.hide();a(true);var Am={setImage:Z,animateTo:t,setSelect:r,setOptions:s,tellSelect:W,tellScaled:Aq,setClass:E,disable:Al,enable:Ar,cancel:f,release:u.release,destroy:O,focus:N.watchKeys,getBounds:function(){return[B*q,M*V]},getWidgetSize:function(){return[B,M]},getScaleFactor:function(){return[q,V]},ui:{holder:Y,selection:g}};if(A.browser.msie){Y.bind("selectstart",function(){return false})}Ad.data("Jcrop",Am);return Am};A.fn.Jcrop=function(B,D){function C(E){var H=(typeof(B)==="object")?B:{};var F=H.useImg||E.src;var G=new Image();G.onload=function(){function J(){var K=A.Jcrop(E,H);if(typeof(D)==="function"){D.call(K)}}function I(){if(!G.width||!G.height){window.setTimeout(I,50)}else{J()}}window.setTimeout(I,50)};G.src=F}this.each(function(){if(A(this).data("Jcrop")){if(B==="api"){return A(this).data("Jcrop")}else{A(this).data("Jcrop").setOptions(B)}}else{C(this)}});return this};A.Jcrop.defaults={allowSelect:true,allowMove:true,allowResize:true,trackDocument:true,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:false,borderOpacity:0.4,handleOpacity:0.5,handleSize:9,handleOffset:5,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,fixedSupport:true,touchSupport:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onRelease:function(){}}}(jQuery));